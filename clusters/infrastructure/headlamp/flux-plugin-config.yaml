---
apiVersion: v1
kind: ConfigMap
metadata:
  name: headlamp-flux-plugin
  namespace: headlamp
data:
  # Flux plugin configuration
  flux-plugin.js: |
    import { registerAppBarAction, registerDetailsViewHeaderAction } from '@kinvolk/headlamp-plugin/lib';
    import { Button } from '@material-ui/core';
    import React from 'react';

    // Register Flux-specific actions
    registerAppBarAction('flux', () => {
      return React.createElement(Button, {
        color: 'inherit',
        onClick: () => {
          window.open('https://fluxcd.io/docs/', '_blank');
        }
      }, 'Flux Docs');
    });

    // Add Flux status indicators for GitRepository, Kustomization, HelmRelease
    registerDetailsViewHeaderAction('gitrepositories.source.toolkit.fluxcd.io', (resource) => {
      const status = resource.status?.conditions?.find(c => c.type === 'Ready');
      const color = status?.status === 'True' ? 'primary' : 'secondary';

      return React.createElement(Button, {
        variant: 'outlined',
        color: color,
        size: 'small'
      }, `Flux: ${status?.status || 'Unknown'}`);
    });

    registerDetailsViewHeaderAction('kustomizations.kustomize.toolkit.fluxcd.io', (resource) => {
      const status = resource.status?.conditions?.find(c => c.type === 'Ready');
      const color = status?.status === 'True' ? 'primary' : 'secondary';

      return React.createElement(Button, {
        variant: 'outlined',
        color: color,
        size: 'small'
      }, `Kustomization: ${status?.status || 'Unknown'}`);
    });

    registerDetailsViewHeaderAction('helmreleases.helm.toolkit.fluxcd.io', (resource) => {
      const status = resource.status?.conditions?.find(c => c.type === 'Ready');
      const color = status?.status === 'True' ? 'primary' : 'secondary';

      return React.createElement(Button, {
        variant: 'outlined',
        color: color,
        size: 'small'
      }, `Helm: ${status?.status || 'Unknown'}`);
    });
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: headlamp-config
  namespace: headlamp
data:
  # Headlamp configuration
  config.json: |
    {
      "clusters": {
        "homelab": {
          "name": "homelab",
          "server": "https://kubernetes.default.svc",
          "useTokenAuth": true
        }
      },
      "defaultCluster": "homelab",
      "plugins": [
        {
          "name": "flux-plugin",
          "url": "/plugins/flux-plugin.js"
        }
      ],
      "ui": {
        "theme": "auto",
        "sidebar": {
          "expanded": true
        }
      }
    }
